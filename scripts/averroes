#! /usr/bin/env bash

set -e

benchmark=$1
base=$2
tfx=$3
dyn=$4

outputdir=${base}/benchmarks-averroes/${benchmark}

# make some dirs
mkdir -p ${outputdir}

echo "running ${benchmark}"
program=$(basename ${benchmark})
  
# 1. run Averroes
cp properties/${benchmark}.properties averroes.properties
jar uf averroes.jar averroes.properties
java -jar averroes.jar ${tfx} ${dyn} 

# 2. copy the output JARs
cp output/organized-app.jar ${outputdir}/organized-app.jar
cp output/organized-lib.jar ${outputdir}/organized-lib.jar
cp output/placeholder-lib.jar ${outputdir}/placeholder-lib.jar
cp output/averroes-lib-class.jar ${outputdir}/averroes-lib-class.jar

echo ""