#! /usr/bin/env bash

set -e

base=$1
tfx=$2
dyn=$3

# the dacapo benchmarks
dacapo=( antlr bloat chart hsqldb luindex lusearch pmd xalan )
dacapo=( "${dacapo[@]/#/dacapo/}" )

# the specjvm benchmarks
specjvm=( compress db jack jess raytrace )
specjvm=( "${specjvm[@]/#/specjvm/}" )

# put them all in one big array
benchmarks=( ${dacapo[@]} ${specjvm[@]} )


date
for benchmark in ${benchmarks[@]}
do
  echo "running averroes on ${benchmark} ..."
  program=$(basename ${benchmark})
  outputdir=${base}/benchmarks-averroes/${benchmark}
  
  # 1. create output directory
  mkdir -p ${outputdir}
  
  # 2. run the script
  ./averroes ${benchmark} ${base} ${tfx} ${dyn} > ${outputdir}/averroes.log
done
date